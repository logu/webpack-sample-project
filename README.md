# Webpack features demonstration

This is a sample project to evaluate some of webpack features while deciding whether or not to move
our Rails application from Sprockets (the Rails Assets Pipeline) to Webpack.

# Setting up the environment

## Install the dependencies

    npm install

Adding new packages can be achieved with `npm install package-name --save` which will add the
dependency to package.json, which is similar to the Gemfile file for Bundler. Differently from
Bundler, `npm install` won't generate a lock file (like Gemfile.lock) but something similar may
be achieved with `npm shrinkwrap` although it won't be run automatically by `npm install`. I'd
appreciate any input from Node.js users on how to manage dependencies in Node. When
`npm install package-name --save` is used, it will specify the version in `package.json`, so
maybe this is the proper way to go for projects...

## Running webpack

Production environment (uglify + cache hash in filename):

    PROD=1 node_modules/.bin/webpack --watch

Development environment:

    node_modules/.bin/webpack --watch

The `--watch` would be omitted in a deployment script of course.

## Running the webpack-dev-server

    PROD=1 npm start

Remove `PROD=1` for testing the dev environment.

You may symlink one of the generated themes to index.html so that it works seamlessly by accessing
http://localhost:8080/webpack-dev-server/

    ln -s index-a.html index.html

`index-a.html` and `index-b.html` are generated based on `index.html.tmpl` so that it works for
PROD mode when the resources hashes must be specified. This is just meant for testing since
integrating a webpack project with a server-side project would involve parsing the
`webpack-assets.json` file to include in the application templates (ERB in Rails by default).
This JSON is generated by the `assets-webpack-plugin` npm package.

# Understanding the project structure

## Differences from Sprockets

- Webpack basically only work with JS files and those can specify dependencies on CSS files,
in which case, by default, an `style` code would be created by JS and the rules appended to that.
In that case it would be possible to save one request with regards to Sprockets and bundle all CSS
and JS in a single JS resource. This project uses another approach though, through the
[extract-text-webpack-plugin](https://webpack.github.io/docs/stylesheets.html). This project uses
2 themes to demonstrate how they can be generated. It's possible to inline some stylesheets in the
bundled JS though, which would result in a mix of downloaded stylesheets and embedded ones. This is
useful to use a separate tiny CSS file to render the initial loading page while the bigger JS
resource is being downloaded since the stylesheet will block the rendering of the page, which could
be useful to render the initial "loading page" while the JS would be loaded assynchronously. An
alternative would be to use inline styles for the initial page for the parts that must look nice
until the JS resource download is finished, in which case the separate CSS generation could be
skipped if desired.
- TODO: compile a list of more differences after I finish my research
